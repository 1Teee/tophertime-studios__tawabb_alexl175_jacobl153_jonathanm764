<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Game</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/play.css') }}">
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
</head>
<body>
    <nav>
      <a href="{{ url_for('home') }}">Home</a>
      <a href="{{ url_for('leaderboard', region='nyc') }}">Leaderboard</a>
      <a href="{{ url_for('profile') }}">Profile</a>
      <a href="{{ url_for('logout') }}">Logout</a>
    </nav>

    <div id="pano"></div>

    <!--shows remaining time for timed mode-->
    {% if mode == 'timed'%}
      <div id="timer">{{ remaining_time }}</div>
    {% endif %}

    <div id="mini-container">
      <div id="mini">
        <button id="guessBtn" hidden>Submit Guess?</button>
      </div>
    </div>

    <form id="guessForm" method="POST" style="display:none">
      <input id="input" name="input" value="">
      <input type="hidden" name="next" value="" disabled>
    </form>

    {% if guessed %}
      <div id="resultMap"></div>
      <button id="nextBtn" class="next-btn" hidden>Next Round</button>
    {% endif %}

    {% if not finished %}
      <script>
      // initialize google street view panorama for the current round.
      // • show player the starting POV
      // • expose position to logs
        window.initStreetView = function () {
          const loc = { lat: {{ lat|float }}, lng: {{ lon|float }} };

          new google.maps.StreetViewPanorama(
            document.getElementById('pano'),
              {
                position: loc,
                pov: { heading: 0, pitch: 0 },
                zoom: 1,
                disableDefaultUI: true,
                showRoadLabels: false
              }
            );
          };
      </script>
      <script src="https://maps.googleapis.com/maps/api/js?key={{ map_key }}&callback=initStreetView"></script>
    {% endif %}

    <script>
      window.gameData = {
        lat: {{ lat|float }},
        lon: {{ lon|float }},
        mapKey: {{ map_key|trim|tojson }},
        mode: {{ mode|tojson }},
        remaining: {{ remaining_time|default(0)|int }},
        guessed: {{ guessed|tojson }},
        guessLat: {{ guess_lat|default(none)|tojson }},
        guessLon: {{ guess_lon|default(none)|tojson }}
      };
    </script>

    <script src="{{ url_for('static', filename='js/play.js') }}"></script>

</body>
</html>
